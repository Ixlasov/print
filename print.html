<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chek</title>
    <style>
        /* 1. Ortiqcha brauzer yozuvlarini yo'qotish uchun eng muhim qism */
        @page {
            size: auto;   /* Avtomatik qog'oz o'lchami */
            margin: 0mm;  /* Hoshiyalarni 0 qilish */
        }

        body {
            font-family: 'Courier New', monospace; /* Chek shrifti */
            width: 74mm;  /* 80mm printer uchun ideal kenglik */
            margin: 0 auto;
            padding: 5px;
            background: #fff;
            color: #000;
            font-size: 14px;
            line-height: 1.2;
        }

        /* Yozuvlar uslubi */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        
        .header { margin-bottom: 10px; }
        .store-name { font-size: 18px; font-weight: bold; text-transform: uppercase; }
        .contact-info { font-size: 12px; margin-top: 5px; }
        
        .dashed-line {
            border-top: 1px dashed #000;
            margin: 5px 0;
            width: 100%;
        }

        /* Mahsulotlar jadvali */
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        td { vertical-align: top; padding: 4px 0; }
        
        /* Siz so'ragan format */
        .item-name { width: 60%; text-align: left; padding-right: 5px; }
        .item-data { width: 40%; text-align: right; font-size: 12px; }

        /* Yakuniy hisob-kitob */
        .totals { margin-top: 5px; font-size: 14px; }
        .row { display: flex; justify-content: space-between; margin-bottom: 3px; }
        .big-total { font-size: 18px; font-weight: bold; margin: 5px 0; border-top: 1px dashed #000; border-bottom: 1px dashed #000; padding: 5px 0; }

        /* Tugma (faqat ekranda ko'rinadi) */
        #printBtn {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: #000; color: #fff;
            padding: 15px; text-align: center; font-size: 18px;
            border: none; cursor: pointer;
        }
        @media print {
            #printBtn { display: none; }
            body { padding: 0; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="header text-center">
        <div class="store-name" id="storeName">DO'KON NOMI</div>
        <div class="contact-info">
            <div id="storeAddress">Manzil: Toshkent sh.</div>
            <div id="storePhone">Tel: +998 90 123-45-67</div>
        </div>
    </div>

    <div class="dashed-line"></div>

    <div style="font-size: 12px;">
        <div>Sana: <span id="tDate"></span></div>
        <div>Mijoz: <span id="tClient"></span></div>
    </div>

    <div class="dashed-line"></div>

    <!-- MAHSULOTLAR RO'YXATI -->
    <table id="itemsTable">
        <!-- JS orqali to'ldiriladi -->
    </table>

    <div class="dashed-line"></div>

    <!-- HISOB-KITOB -->
    <div class="totals">
        <div class="row"><span>Jami savdo:</span> <span id="tSubtotal">0</span></div>
        <div class="row"><span>Chegirma:</span> <span id="tDiscount">0</span></div>
        
        <div class="row big-total">
            <span>TO'LOV:</span> <span id="tGrandTotal">0</span>
        </div>

        <div class="row"><span>To'landi:</span> <span id="tPaid">0</span></div>
        <div class="row bold"><span>Qarz (Qoldiq):</span> <span id="tDebt">0</span></div>
    </div>

    <div class="text-center" style="margin-top: 20px; font-size: 12px;">
        Xaridingiz uchun rahmat!
    </div>
    
    <!-- Bo'sh joy (chek oxiri kesilganda yozuv kesilmasligi uchun) -->
    <br><br>

    <button id="printBtn" onclick="window.print()">CHOP ETISH</button>

    <script>
        function formatMoney(num) {
            if(!num) return "0";
            return parseFloat(num).toLocaleString('uz-UZ').replace(/,/g, " ");
        }

        const params = new URLSearchParams(window.location.search);
        
        // --- 1. MA'LUMOTLARNI OLISH ---
        const rawItems = params.get('items');
        
        // Do'kon ma'lumotlari (Agar URLda kelmasa, shu yerdagisi chiqadi)
        document.getElementById('storeName').innerText = params.get('store') || "SUPER MARKET";
        document.getElementById('storeAddress').innerText = params.get('addr') || "Manzil: Markaziy bozor";
        document.getElementById('storePhone').innerText = "Tel: " + (params.get('phone') || "+998 00 000-00-00");
        
        // Chek ma'lumotlari
        document.getElementById('tDate').innerText = params.get('date') || new Date().toLocaleString();
        document.getElementById('tClient').innerText = params.get('client') || "Noma'lum";

        // Pullar
        document.getElementById('tSubtotal').innerText = formatMoney(params.get('subtotal'));
        document.getElementById('tDiscount').innerText = formatMoney(params.get('discount'));
        document.getElementById('tGrandTotal').innerText = formatMoney(params.get('total'));
        document.getElementById('tPaid').innerText = formatMoney(params.get('paid'));
        document.getElementById('tDebt').innerText = formatMoney(params.get('debt'));

        // --- 2. MAHSULOTLARNI CHIZISH ---
        const table = document.getElementById('itemsTable');

        if (rawItems) {
            const rows = rawItems.split('~');
            rows.forEach(row => {
                if(row.trim()) {
                    // Format: Nom|Son|Narx|Jami
                    const cols = row.split('|');
                    if(cols.length >= 4) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td class="item-name">${cols[0]}</td>
                            <td class="item-data">
                                ${cols[1]} dona<br>
                                x ${formatMoney(cols[2])}<br>
                                <span class="bold">=${formatMoney(cols[3])}</span>
                            </td>
                        `;
                        table.appendChild(tr);
                    }
                }
            });
            // Avtomatik chop etish
            setTimeout(() => window.print(), 800);
        } else {
            // TEST REJIMI (Ma'lumot kelmasa ko'rinadigan holat)
            table.innerHTML = `
                <tr>
                    <td class="item-name">Coca Cola 1.5L</td>
                    <td class="item-data">2 dona<br>x 12 000<br><span class="bold">=24 000</span></td>
                </tr>
                <tr>
                    <td class="item-name">Non (Buxanka)</td>
                    <td class="item-data">4 dona<br>x 3 000<br><span class="bold">=12 000</span></td>
                </tr>
            `;
            document.getElementById('tGrandTotal').innerText = "36 000";
        }
    </script>
</body>
</html>
